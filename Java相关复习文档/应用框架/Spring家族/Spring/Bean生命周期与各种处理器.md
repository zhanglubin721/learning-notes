## ** Spring Bean ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼ˆç²¾ç»†ç‰ˆï¼‰**

> ä»¥ä¸‹æ˜¯ Spring Bean åˆ›å»ºè¿‡ç¨‹çš„è¯¦ç»†ç”Ÿå‘½å‘¨æœŸï¼Œå·¦è¾¹æ˜¯ç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼Œå³è¾¹æ˜¯å¤„ç†å™¨æ‰©å±•ç‚¹ï¼ˆä½ å¯ä»¥è‡ªå®šä¹‰å®ç°å®ƒä»¬ï¼‰ï¼š

### **ä¸€ã€å®¹å™¨å¯åŠ¨é˜¶æ®µï¼ˆè¿˜æ²¡å¼€å§‹å®ä¾‹åŒ– Beanï¼‰**

| **é˜¶æ®µ**                  | **è¯´æ˜**                                               | **ç›¸å…³æ‰©å±•æ¥å£**                                         |
| ------------------------- | ------------------------------------------------------ | -------------------------------------------------------- |
| 1ï¸âƒ£ è¯»å–é…ç½®ç±» / XML        | è§£æé…ç½®ã€æ‰«æç±»ã€åŠ è½½ BeanDefinitionï¼ˆBean çš„å…ƒä¿¡æ¯ï¼‰ | æ—                                                        |
| 2ï¸âƒ£ BeanDefinition æ³¨å†Œå®Œæˆ | Bean è¿˜æ²¡å®ä¾‹åŒ–ï¼Œåªæ˜¯å®šä¹‰è¢«æ³¨å†Œåˆ°å®¹å™¨                  | BeanDefinitionRegistryPostProcessorï¼ˆå¯ä»¥åŠ¨æ€æ³¨å†Œ Beanï¼‰ |
| 3ï¸âƒ£ å®¹å™¨åˆ·æ–°å‰              | å¯ä»¥ä¿®æ”¹ BeanDefinition å†…å®¹ï¼ˆå¦‚ scopeã€lazy-initï¼‰    | BeanFactoryPostProcessor                                 |

### **äºŒã€å•ä¸ª Bean åˆ›å»ºæµç¨‹ï¼ˆä»¥æŸä¸ªå…·ä½“ Bean ä¸ºä¾‹ï¼‰**

> ä»¥ä¸‹æ˜¯å®¹å™¨å¼€å§‹æ­£å¼åˆ›å»ºæŸä¸ª Bean æ—¶çš„è¯¦ç»†æµç¨‹ï¼ˆé‡ç‚¹ï¼‰ï¼š

| **æ­¥éª¤**                                                     | **æè¿°**                                           | **æ‰§è¡Œçš„å¤„ç†å™¨**                         |
| ------------------------------------------------------------ | -------------------------------------------------- | ---------------------------------------- |
| 1ï¸âƒ£ åˆ¤æ–­æ˜¯å¦æ˜¯å•ä¾‹ï¼Œæ˜¯åˆ™ä»ç¼“å­˜è·å–                             | -                                                  | -                                        |
| 2ï¸âƒ£ æ‰§è¡Œ InstantiationAwareBeanPostProcessor çš„ **postProcessBeforeInstantiation** | å…è®¸ä½ è‡ªå·±åˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ï¼Œå¸¸ç”¨äºä»£ç†ï¼ˆå¦‚ AOPï¼‰ | InstantiationAwareBeanPostProcessor      |
| 3ï¸âƒ£ å¦‚æœä¸Šä¸€æ­¥è¿”å›é nullï¼Œåˆ™è·³è¿‡åç»­å®ä¾‹åŒ–æµç¨‹ï¼ˆç›´æ¥è¿”å›ï¼‰    | -                                                  | -                                        |
| 4ï¸âƒ£ å®ä¾‹åŒ– Beanï¼ˆé€šè¿‡æ„é€ æ–¹æ³•ï¼‰                                | ç›¸å½“äº new Xxx()                                   | -                                        |
| 5ï¸âƒ£ æ‰§è¡Œ InstantiationAwareBeanPostProcessor çš„ **postProcessAfterInstantiation** | æ˜¯å¦ç»§ç»­è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ˆè¿”å› false åˆ™è·³è¿‡æ³¨å…¥ï¼‰      | InstantiationAwareBeanPostProcessor      |
| 6ï¸âƒ£ å±æ€§æ³¨å…¥ï¼ˆsetXxxï¼‰                                         | @Autowired, @Value, æ„é€ æ³¨å…¥ç­‰                     | AutowiredAnnotationBeanPostProcessor ç­‰  |
| 7ï¸âƒ£ æ‰§è¡Œ InstantiationAwareBeanPostProcessor çš„ **postProcessProperties**ï¼ˆSpring 5 æ–°æ–¹æ³•ï¼‰ | å¯ä»¥ä¿®æ”¹å±æ€§å€¼æˆ–è‡ªå®šä¹‰ä¾èµ–æ³¨å…¥                     | SmartInstantiationAwareBeanPostProcessor |
| 8ï¸âƒ£ æ‰§è¡Œ Aware æ¥å£ï¼ˆå¦‚ BeanNameAware, BeanFactoryAwareï¼‰      | è®© Bean è·å–å®¹å™¨ä¿¡æ¯                               | -                                        |
| 9ï¸âƒ£ æ‰§è¡Œ BeanPostProcessor çš„ **postProcessBeforeInitialization** | åˆå§‹åŒ–ä¹‹å‰é€»è¾‘å¢å¼º                                 | BeanPostProcessor                        |
| ğŸ”Ÿ è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ï¼ˆé¡ºåºå¦‚ä¸‹ï¼‰                                 | -                                                  | -                                        |
| - @PostConstruct                                             | -                                                  | -                                        |
| - InitializingBean.afterPropertiesSet()                      | -                                                  | -                                        |
| - XML æˆ– Java Config ä¸­é…ç½®çš„ init-method                    | -                                                  | -                                        |
| 1ï¸âƒ£1ï¸âƒ£ æ‰§è¡Œ BeanPostProcessor çš„ **postProcessAfterInitialization** | åˆå§‹åŒ–ä¹‹åé€»è¾‘å¢å¼ºï¼ˆAOP ä»£ç†å¤šåœ¨æ­¤æ—¶ï¼‰             | BeanPostProcessor                        |
| âœ… æœ€ç»ˆè¿”å› Beanï¼Œæ³¨å†Œè¿›ä¸€çº§ç¼“å­˜                              | å•ä¾‹ Bean è¿›å…¥å®¹å™¨                                 | -                                        |

## **å›¾ç¤ºï¼šSpring Bean ç”Ÿå‘½å‘¨æœŸåŠå¤„ç†å™¨æ‰§è¡Œä½ç½®**

```
å®¹å™¨å¯åŠ¨é˜¶æ®µï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ BeanDefinitionRegistryPostProcessor          â”‚  --> æ³¨å†Œæ–° BeanDefinition
 â”‚ BeanFactoryPostProcessor                     â”‚  --> ä¿®æ”¹ BeanDefinition å±æ€§
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å•ä¸ª Bean åˆ›å»ºæµç¨‹ï¼š
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ æ„é€ å‰ï¼ˆä»£ç†ï¼‰â”‚ --> InstantiationAwareBeanPostProcessor.postProcessBeforeInstantiation
 â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ æ„é€  Bean    â”‚ --> é€šè¿‡æ„é€ æ–¹æ³• new å‡º Bean å®ä¾‹
 â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ å±æ€§æ³¨å…¥     â”‚ --> AutowiredAnnotationBeanPostProcessor ç­‰
 â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ postProcessBeforeInit       â”‚ --> BeanPostProcessor
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ åˆå§‹åŒ–ï¼š@PostConstruct ç­‰     â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ postProcessAfterInit        â”‚ --> BeanPostProcessorï¼ˆå¸¸ç”¨äº AOPï¼‰
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       âœ… Bean æ³¨å†Œå®Œæˆï¼ŒåŠ å…¥å®¹å™¨
```

## **å°ç»“ï¼šå„ç±»å¤„ç†å™¨å¯¹æ¯”**

| **æ¥å£å**                               | **æ‰§è¡Œé˜¶æ®µ**         | **ä½œç”¨**                     |
| ---------------------------------------- | -------------------- | ---------------------------- |
| BeanDefinitionRegistryPostProcessor      | å®¹å™¨åˆ·æ–°å‰           | æ³¨å†Œæˆ–ä¿®æ”¹ BeanDefinition    |
| BeanFactoryPostProcessor                 | å®¹å™¨åˆ·æ–°å‰           | ä¿®æ”¹å·²æœ‰ BeanDefinition å†…å®¹ |
| InstantiationAwareBeanPostProcessor      | æ„é€ å‰/æ„é€ å/æ³¨å…¥æ—¶ | æ§åˆ¶å®ä¾‹åŒ–/æ³¨å…¥è¿‡ç¨‹          |
| BeanPostProcessor                        | åˆå§‹åŒ–å‰å           | å¢å¼º Beanï¼Œå¦‚ä»£ç†            |
| SmartInstantiationAwareBeanPostProcessor | å±æ€§æ³¨å…¥æ—¶           | ç²¾å‡†å¤„ç†æ„é€ å™¨é€‰æ‹©ã€ä¾èµ–æ³¨å…¥ |
| DestructionAwareBeanPostProcessor        | Bean é”€æ¯å‰          | æ¸…ç†èµ„æº                     |